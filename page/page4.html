<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="../css/style.css">
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
<div class="grid-container">
<div class="description">
<p style="text-align: center;"><strong><u>S&amp;P Future Prediction based on Hypothetical Scenarios</u></strong></p>
<p style="text-align: left;">The stock market prices are driven by the relative ration of buyers and sellers. Contributing factors will be consumer activity recovery, election (future stimulus uncertainty), and the severity of Covid19 spread (fear factor).</p>
<p style="text-align: left;">Scenario 1:</p>
<p style="text-align: left;">Covid19 spread slows down. Consumer activities recover and spending increases. Election candidates are hopeful the economy will recover soon. Therefore, a further stimulus package is unlikely. In this scenario, the stock market can go down because buyers will liquidate stock investment profit and move to other consuming and investment activities.</p>
<p style="text-align: left;">Scenario 2:</p>
<p style="text-align: left;">Covid19 spread continues. Consumer spending activities remain in limbo. Election candidates promise further stimulus package to boost the economy. In this scenario, the stock market can go up further with buyers having more cash invest.</p>
<p style="text-align: left;">Select a scenario below to see the future prediction on the graph</p>
<div class="wrapper">
<button onclick="update(data_1)">Scenario 1</button>
<button onclick="update(data_2)">Scenario 2</button>
</div>
</div>
<div id="my_dataviz"></div>
</div>
<script>

//  data[AFG] = {"name": "Afghanistan", "estimate": 9.003, ... }
var raw_data_1 = [
  {"date": "2020-05-01", "value": 2920},
  {"date": "2020-06-01", "value": 3207},
  {"date": "2020-07-01", "value": 3154},
  {"date": "2020-08-01", "value": 3271},
  {"date": "2020-09-01", "value": 3271},
  {"date": "2020-10-01", "value": 3271},
  {"date": "2020-11-01", "value": 3271},
  {"date": "2020-12-01", "value": 3271}
];

var raw_data_2 = [
  {"date": "2020-05-01", "value": 2920},
  {"date": "2020-06-01", "value": 3207},
  {"date": "2020-07-01", "value": 3154},
  {"date": "2020-08-01", "value": 3271},
  {"date": "2020-09-01", "value": 3671},
  {"date": "2020-10-01", "value": 3271},
  {"date": "2020-11-01", "value": 4571},
  {"date": "2020-12-01", "value": 5271}
];

var formatComma = d3.format(",");

var margin = {top: 30, right: 30, bottom: 50, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  // When reading the csv, I must format variables:
  var data_1 = [];
  raw_data_1.forEach(d => data_1.push({date: d3.timeParse("%Y-%m-%d")(d.date), value: d.value}));

  var data_2 = [];
  raw_data_2.forEach(d => data_2.push({date: d3.timeParse("%Y-%m-%d")(d.date), value: d.value}));

 

   // create a tooltip
    var Tooltip = d3.select("#my_dataviz")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "white")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px")

function update(data) {
 //console.log(data)
    var x = d3.scaleTime()
      .domain(d3.extent(data, function(d) { return d.date; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));
    // Add Y axis
    var y = d3.scaleLinear()
      .domain( [2000, 3500])
      .range([ height, 0 ]);
    svg.append("g")
      .call(d3.axisLeft(y));
    // Add the line

    svg.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "#707070")
      .attr("stroke-width", 1.5)
      .attr("d", d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.value) })
        )


    const annotations = [{
      note: {
        title: "Feb 3",
        label: "The Trump administration declares a public health emergency",
        wrap: 200,  // try something smaller to see text split in several lines
        padding: 10,   // More = text lower
      },
      color: ["#DC143C"],
      //data: { date: "20-03-20", value: 1850 },
      y: 95,
      x: 70,
      dy: 120,
      dx: 0
    },
    {
      note: {
        title: "July 31",
        label: "The index returned to near all time high",
        wrap: 300,  // try something smaller to see text split in several lines
        padding: 10,   // More = text lower
        align: "right"
      },
      color: ["#008000"],
      //data: { date: "20-03-20", value: 1850 },
      y: 50,
      x: 375,
      dy: -12,
      dx: -35
    }]

    const makeAnnotations = d3.annotation().annotations(annotations)


    // Add X axis label:
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width)
      .attr("y", height+40 )
      .text("Time");

    // Add Y axis label:
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", 0)
      .attr("y", -20 )
      .text("# of brokerage account")
      .attr("text-anchor", "start")

    // Add the points
    svg
      .append("g")
      .selectAll("dot")
      .data(data)
      .enter()
      .call(makeAnnotations)

  var u = svg.selectAll(".lineTest")
    .data([data], function(d){ return d.ser1 });


}
update(data_1)

</script>

</script>
</body>
</html>